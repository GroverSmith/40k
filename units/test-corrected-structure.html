<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Corrected MFM Structure</title>
</head>
<body>
    <h1>Test Corrected MFM Structure</h1>
    <div id="results"></div>

    <!-- Load the corrected data files -->
    <script src="../mfm/mfm-units-3_2.js"></script>
    <script src="../mfm/mfm-units-3_3.js"></script>
    <script src="../mfm/mfm-units-bundle.js"></script>
    
    <script src="../mfm/mfm-detachments-3_2.js"></script>
    <script src="../mfm/mfm-detachments-3_3.js"></script>
    <script src="../mfm/mfm-detachments-bundle.js"></script>

    <script>
        async function testCorrectedStructure() {
            const results = document.getElementById('results');
            
            try {
                results.innerHTML += '<h2>Testing Corrected Structure:</h2>';
                
                // Test detachments structure
                if (window.MFM_DETACHMENTS_3_2) {
                    results.innerHTML += '<p>‚úÖ MFM Detachments 3.2 loaded successfully</p>';
                    
                    const adeptaSororitas = window.MFM_DETACHMENTS_3_2.factions['ADEPTA SORORITAS'];
                    if (adeptaSororitas) {
                        results.innerHTML += `<p>üìä Adepta Sororitas has ${adeptaSororitas.detachmentCount} detachments</p>`;
                        
                        // Test the corrected structure
                        if (adeptaSororitas.detachments) {
                            results.innerHTML += '<p>‚úÖ Corrected structure: "detachments" instead of "enhancements"</p>';
                            
                            const armyOfFaith = adeptaSororitas.detachments['Army of Faith'];
                            if (armyOfFaith && armyOfFaith.enhancements) {
                                results.innerHTML += `<p>‚úÖ Army of Faith detachment has ${armyOfFaith.enhancements.length} enhancements</p>`;
                                
                                // Show sample enhancements
                                const sampleEnhancements = armyOfFaith.enhancements.slice(0, 3);
                                results.innerHTML += `<p>üìã Sample enhancements: ${sampleEnhancements.map(e => `${e.name} (${e.points} pts)`).join(', ')}</p>`;
                            }
                        }
                        
                        // Test detachment count is non-zero
                        if (adeptaSororitas.detachmentCount > 0) {
                            results.innerHTML += '<p>‚úÖ Detachment count is non-zero (corrected from previous structure)</p>';
                        }
                    }
                }
                
                // Test units structure (should be unchanged)
                if (window.MFM_UNITS_3_2) {
                    results.innerHTML += '<p>‚úÖ MFM Units 3.2 loaded successfully</p>';
                    
                    const spaceMarines = window.MFM_UNITS_3_2.factions['SPACE MARINES'];
                    if (spaceMarines) {
                        results.innerHTML += `<p>üìä Space Marines has ${Object.keys(spaceMarines.units).length} units</p>`;
                    }
                }
                
                // Test bundles
                if (window.MFM_DETACHMENTS_BUNDLE) {
                    results.innerHTML += '<p>‚úÖ MFM Detachments Bundle loaded successfully</p>';
                    
                    const detachments32 = await window.MFM_DETACHMENTS_BUNDLE.loadVersion('3.2');
                    results.innerHTML += `<p>‚úÖ Successfully loaded detachments version 3.2 (${detachments32.metadata.totalEnhancements} enhancements)</p>`;
                }
                
                results.innerHTML += '<h2>üéâ Structure Corrections Verified!</h2>';
                results.innerHTML += '<p><strong>Key Improvements:</strong></p>';
                results.innerHTML += '<ul>';
                results.innerHTML += '<li>‚úÖ "detachments" instead of "enhancements" at higher level</li>';
                results.innerHTML += '<li>‚úÖ "detachmentCount" instead of "enhancementCount"</li>';
                results.innerHTML += '<li>‚úÖ Detachment counts are now non-zero</li>';
                results.innerHTML += '<li>‚úÖ Direct parsing from raw text to JS files</li>';
                results.innerHTML += '<li>‚úÖ Separated units and detachments data</li>';
                results.innerHTML += '<li>‚úÖ All files organized in mfm/ directory</li>';
                results.innerHTML += '</ul>';
                
            } catch (error) {
                results.innerHTML += `<p>‚ùå Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }
        
        // Run the test when page loads
        document.addEventListener('DOMContentLoaded', testCorrectedStructure);
    </script>
</body>
</html>
