<!-- filename: units/unit-add.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Unit - 40k Crusade Campaign Tracker</title>
    <meta name="description" content="Add a new unit or character to your Crusade force.">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/buttons-unified.css">
    <link rel="stylesheet" href="../css/components-unified.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="../css/forms-unified.css">
    <link rel="stylesheet" href="../css/modal.css">
    <link rel="stylesheet" href="../css/user-dropdown.css">
    <link rel="stylesheet" href="../css/user-field.css">
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-button">← Back to Campaign Tracker</a>
        
        <header>
            <h1>Add Unit or Character</h1>
            <p>Add a new unit or character to your Crusade force roster.</p>
        </header>
        
        <main>
            <form id="add-unit-form" class="crusade-form">
                <!-- Basic Information -->
                <fieldset>
                    <legend>Basic Information</legend>
                    
                    <div class="form-group">
                        <div class="force-display-container">
                            <span class="force-label">FORCE:</span>
                            <a id="force-name" class="force-name-link" href="#"></a>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>MFM Version <span class="required">*</span></label>
                        <div class="mfm-version-container">
                            <div class="mfm-toggle-group">
                                <div class="mfm-toggle-option">
                                    <input type="radio" id="mfm-preset" name="mfmMode" value="preset" checked>
                                    <label for="mfm-preset">
                                        <span class="toggle-label">MFM</span>
                                        <span class="toggle-description">Use official points data</span>
                                    </label>
                                </div>
                                <div class="mfm-toggle-option">
                                    <input type="radio" id="mfm-custom" name="mfmMode" value="custom">
                                    <label for="mfm-custom">
                                        <span class="toggle-label">Custom Version</span>
                                        <span class="toggle-description">Enter custom data sheet</span>
                                    </label>
                                </div>
                            </div>
                            <div id="mfm-preset-container" class="mfm-input-container">
                                <select id="mfm-version-preset" name="mfmVersion">
                                    <option value="3.2" selected>MFM 3.2 (Aug 2025)</option>
                                    <option value="3.3">MFM 3.3 (Sep 2025)</option>
                                </select>
                            </div>
                            <div id="mfm-custom-container" class="mfm-input-container" style="display: none;">
                                <input type="text" id="mfm-version-custom" name="mfmVersionCustom" 
                                       placeholder="e.g., 2025.08 or enter custom">
                            </div>
                        </div>
                        <small class="help-text">Choose between official MFM data or custom entry</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="data-sheet">Data Sheet <span class="required">*</span></label>
                        <div class="searchable-dropdown-container">
                            <input type="text" id="data-sheet-search" placeholder="Type to search units..." 
                                   class="search-input" style="display: none;">
                            <select id="data-sheet" name="dataSheet" required>
                                <option value="">-- Select Data Sheet --</option>
                            </select>
                        </div>
                        <small class="help-text">Select from available units in your faction</small>
                    </div>
                    
                    <div class="form-group" id="variant-group" style="display: none;">
                        <label for="unit-variant">Unit Variant <span class="required">*</span></label>
                        <select id="unit-variant" name="unitVariant" required>
                            <option value="">-- Select Variant --</option>
                        </select>
                        <small class="help-text">Choose the specific variant and model count</small>
                    </div>
                    
                    <!-- Unit Type Group Component will be loaded here -->
                    <div id="unit-type-container"></div>
                    
                    <div class="form-group" id="points-group" style="display: none;">
                        <label for="points">Points Value</label>
                        <input type="number" id="points" name="points" min="0" max="9999" 
                               placeholder="e.g., 85">
                        <small class="help-text">Base points cost</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="unit-name">Unit/Character Name <span class="required">*</span></label>
                        <input type="text" id="unit-name" name="name" required 
                               placeholder="e.g., Captain Aurelius, Squad Alpha, Predator 'Iron Fist'">
                        <small class="help-text">Give your unit a unique name for identification</small>
                    </div>
                </fieldset>
                
                
                <!-- Wargear and Upgrades -->
                <fieldset>
                    <legend>Wargear and Upgrades</legend>
                    
                    <div class="form-group">
                        <label for="wargear">Wargear</label>
                        <textarea id="wargear" name="wargear" rows="2" 
                                  placeholder="e.g., Bolt rifle, Frag grenades, Krak grenades"></textarea>
                        <small class="help-text">List all wargear (comma-separated)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="enhancements">Enhancements</label>
                        <textarea id="enhancements" name="enhancements" rows="2" 
                                  placeholder="e.g., Master of the Vanguard, Artificer Armour"></textarea>
                        <small class="help-text">List any enhancements (comma-separated)</small>
                    </div>
                    
                </fieldset>
                
                
                
                <!-- Narrative Information -->
                <fieldset>
                    <legend>Narrative Information</legend>
                    
                    <div class="form-group">
                        <label for="description">Unit Description</label>
                        <textarea id="description" name="description" rows="3" 
                                  placeholder="Describe the unit's appearance, personality, or combat style..."></textarea>
                        <small class="help-text">Describe your unit's character and appearance</small>
                    </div>
                    
                    
                    <div class="form-group">
                        <label for="notes">Additional Notes</label>
                        <textarea id="notes" name="notes" rows="2" 
                                  placeholder="Any other information..."></textarea>
                    </div>
                </fieldset>
                
                <!-- Hidden fields for keys -->
                <input type="hidden" id="user-key" name="userKey">
                <input type="hidden" id="force-key" name="forceKey">
                
                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" onclick="window.history.back()" class="btn-secondary">Cancel</button>
                    <button type="submit" id="submit-btn" class="btn-primary">
                        <span class="btn-text">Add Unit</span>
                        <span class="btn-loading" style="display: none;">
                            <div class="loading-spinner"></div>
                            Adding Unit...
                        </span>
                    </button>
                </div>
            </form>
            
            <!-- Success Message -->
            <div id="success-message" class="message success" style="display: none;">
                <h3>✅ Unit Added Successfully!</h3>
                <p>The unit has been added to your force roster.</p>
                <div class="message-actions">
                    <a href="../index.html" class="btn-secondary">Back to Home</a>
                    <button onclick="location.reload()" class="btn-primary">Add Another Unit</button>
                </div>
            </div>
            
            <!-- Error Message -->
            <div id="error-message" class="message error" style="display: none;">
                <h3>⚠ Error Adding Unit</h3>
                <p id="error-text">There was an error adding the unit. Please try again.</p>
            </div>
        </main>
    </div>

    <!-- JavaScript Files -->
    <!-- JavaScript Files -->
    <script src="../js/core/utils.js"></script>
    <script src="../js/core/config.js"></script>
    <script src="../js/core/key-utils.js"></script>

    <!-- NEW consolidated utilities -->
    <script src="../js/core/form-utilities.js"></script>
    <script src="../js/core/ui-helpers.js"></script>

    <!-- UnifiedCache dependencies -->
    <script src="../js/table-defs.js"></script>
    <script src="../js/core/unified-cache-facade.js"></script>
    
    <!-- User modules -->
    <script src="../js/users/user-storage.js"></script>
    <script src="../js/users/user-api.js"></script>
    <script src="../js/users/user-ui.js"></script>
    <script src="../js/users/user-modal.js"></script>
    <script src="../js/users/user-manager.js"></script>

    <!-- Other dependencies -->

    <!-- MFM Data Files -->
    <script src="../mfm/mfm-base.js"></script>
    <script src="../mfm/mfm-units.js"></script>
    
    <!-- Form modules -->
    <script src="../js/core/form-base.js"></script>
    <script src="unit-form-utils.js"></script>
    <script src="unit-add.js"></script>

</body>
</html>