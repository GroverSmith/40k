<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40k Crusade Campaign Tracker</title>
    <style>
        * {
            box-sizing: border-box;
        }
		
		.sheets-container {
            margin: 20px 0;
        }

        .sheets-table-wrapper {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
            margin-top: 10px;
            background-color: #2a2a2a;
        }

        .sheets-table-wrapper.no-scroll {
            max-height: none;
            overflow: visible;
            border: none;
        }

        .sheets-loading {
            text-align: center;
            color: #cccccc;
            font-style: italic;
            padding: 20px;
        }

        .sheets-error {
            background-color: #4a1e1e;
            border: 1px solid #cc6666;
            color: #ff9999;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .sheets-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            background-color: #2a2a2a;
        }

        .sheets-table th,
        .sheets-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #4a4a4a;
            font-size: 14px;
            color: #ffffff;
        }

        .sheets-table th {
            background-color: #3a3a3a;
            font-weight: bold;
            color: #4ecdc4;
            border-bottom: 2px solid #4ecdc4;
            cursor: pointer;
            user-select: none;
            position: sticky;
            top: 0;
            z-index: 10;
            padding-right: 25px;
        }

		.sheets-table th:hover {
            background-color: #4a4a4a;
        }

        .sheets-table th .sort-indicator {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #cccccc;
        }

        .sheets-table th.sort-asc .sort-indicator::after {
            content: '‚ñ≤';
            color: #4ecdc4;
        }

        .sheets-table th.sort-desc .sort-indicator::after {
            content: '‚ñº';
            color: #4ecdc4;
        }

        .sheets-table th:not(.sort-asc):not(.sort-desc) .sort-indicator::after {
            content: '‚áÖ';
        }

        .sheets-table tr:hover {
            background-color: #3a3a3a;
        }

        .sheets-refresh {
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            float: right;
            margin-top: 10px;
            line-height: normal;
            box-sizing: border-box;
        }

        .sheets-refresh:hover {
            background-color: #1e4080;
        }

        .sheets-refresh:disabled {
            background-color: #555555;
            cursor: not-allowed;
        }

        .sheets-pagination {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .sheets-pagination button {
            background-color: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: #ffffff;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .sheets-pagination button:hover:not(:disabled) {
            background-color: #4a4a4a;
        }

        .sheets-pagination button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .sheets-pagination .page-info {
            color: #cccccc;
            font-size: 14px;
        }

        .sheets-pagination select {
            padding: 4px 8px;
            border: 1px solid #4a4a4a;
            border-radius: 4px;
            font-size: 14px;
            background-color: #3a3a3a;
            color: #ffffff;
        }

        .sheets-table a {
            color: #4ecdc4;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .sheets-table a:hover {
            color: #7fefea;
            text-decoration: underline;
        }

        .sheets-table a:visited {
            color: #3fb8b1;
        }

        .sheets-stats {
            margin-top: 10px;
            padding: 10px;
            background-color: #3a3a3a;
            border-radius: 4px;
            color: #cccccc;
            font-size: 12px;
        }

        .add-force-btn {
            display: inline-block;
            background-color: #2c5aa0;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            float: left;
            margin-top: 10px;
            line-height: normal;
            box-sizing: border-box;
        }

        .add-force-btn:hover {
            background-color: #1e4080;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 16px;
            background-color: #1a1a1a;
            color: #ffffff;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        h1 {
            color: #2c5aa0;
            font-size: 2.2em;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        
        h2 {
            color: #4ecdc4;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        p {
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .features {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            text-align: left;
        }
        
        .features ul {
            max-width: 100%;
            margin: 0;
            padding-left: 20px;
        }
        
        .features li {
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        /* Mobile optimizations */
        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
            
            h1 {
                font-size: 1.8em;
                line-height: 1.2;
            }
            
            h2 {
                font-size: 1.3em;
            }
            
            .features {
                padding: 16px;
                margin: 20px 0;
            }
            
            .features li {
                font-size: 15px;
                margin-bottom: 10px;
            }

            .sheets-table-wrapper {
                max-height: 300px;
            }

            .sheets-pagination {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .sheets-pagination .page-info {
                text-align: center;
            }
        }
        
        /* Very small screens */
        @media (max-width: 360px) {
            h1 {
                font-size: 1.6em;
            }
            
            .features {
                padding: 12px;
            }

            .sheets-table th,
            .sheets-table td {
                padding: 6px 8px;
                font-size: 13px;
            }

            .sheets-table-wrapper {
                max-height: 250px;
            }
        }
        
        /* Touch-friendly spacing */
        @media (hover: none) and (pointer: coarse) {
            .features li {
                margin-bottom: 14px;
                padding: 4px 0;
            }

            .sheets-table th,
            .sheets-table td {
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>40k Crusade Campaign Tracker</h1>
        
        <p>Welcome to your digital command center for Warhammer 40,000 Crusade campaigns!</p>
        
        <div class="features">
            <h2>Active Crusades</h2>
            <p>No active crusades currently running.</p>
        </div>
        
        <div class="features">
            <h2>Upcoming Crusades</h2>
            <p>No upcoming crusades planned.</p>
        </div>
        
        <div class="features">
            <h2>Past Crusades</h2>
            <p>No completed crusades to display.</p>
        </div>
        
        <div class="features">
            <h2>Crusade Forces</h2>
			<div id="crusade-forces-sheet"></div>
			<div style="clear: both;"></div>
        </div>
        
        <div class="features">
            <h2>Stories</h2>
            <p>No battle reports or narrative stories recorded.</p>
        </div>
    </div>
	
	<script>
        class GoogleSheetsEmbed {
            constructor(containerSelector, appsScriptUrl, options = {}) {
                this.container = document.querySelector(containerSelector);
                this.appsScriptUrl = appsScriptUrl;
                this.options = {
                    showRefreshButton: true,
                    autoLoad: true,
                    showStats: true,
                    sortable: true,
                    maxRows: null,        // null = show all rows
                    maxHeight: '400px',   // max height before scrolling
                    pagination: false,    // enable pagination instead of scrolling
                    rowsPerPage: 50,      // rows per page when pagination is enabled
                    linkColumn: null,     // column index to convert to links (null = no links)
                    linkPattern: '{slug}.html',  // URL pattern where {slug} gets replaced
                    cacheMinutes: 5,      // cache data for 5 minutes (0 = no cache)
                    hideColumns: [],      // array of column indices to hide (e.g., [0, 2])
                    ...options
                };
                this.rawData = null;
                this.sortColumn = null;
                this.sortDirection = 'asc';
                this.currentPage = 1;
                
                if (this.container) {
                    this.init();
                } else {
                    console.warn(`Container "${containerSelector}" not found`);
                }
            }
            
            init() {
                this.container.classList.add('sheets-container');
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'sheets-content';
                this.container.appendChild(contentDiv);
                this.contentDiv = contentDiv;
                
                // Create button container for both buttons
                const buttonContainer = document.createElement('div');
                buttonContainer.style.marginTop = '10px';
                buttonContainer.style.overflow = 'hidden'; // Clear float
                
                // Add the "Add New Force" button (left-aligned)
                const addForceBtn = document.createElement('a');
                addForceBtn.href = 'https://docs.google.com/forms/d/e/1FAIpQLSf0CasoHdP0VuxvBaEbmAxc2Tsi0AeA1saHBa1EMfC4do4EOw/viewform?usp=dialog';
                addForceBtn.target = '_blank';
                addForceBtn.className = 'add-force-btn';
                addForceBtn.textContent = '+ Add New Force';
                buttonContainer.appendChild(addForceBtn);
                
                // Add refresh button if enabled (right-aligned)
                if (this.options.showRefreshButton) {
                    const refreshBtn = document.createElement('button');
                    refreshBtn.className = 'sheets-refresh';
                    refreshBtn.textContent = 'Refresh Data';
                    refreshBtn.onclick = () => this.refresh(); // Use refresh() instead of loadData()
                    buttonContainer.appendChild(refreshBtn);
                    this.refreshBtn = refreshBtn;
                }
                
                this.container.appendChild(buttonContainer);
                
                if (this.options.autoLoad) {
                    this.loadData();
                }
            }
            
            async loadData() {
                this.showLoading();
                
                try {
                    // Check for cached data first
                    const cachedData = this.getCachedData();
                    if (cachedData && !this.isCacheExpired(cachedData.timestamp)) {
                        console.log('Loading from cache:', this.appsScriptUrl);
                        this.rawData = cachedData.data;
                        this.displayData(cachedData.data);
                        return;
                    }
                    
                    console.log('Loading fresh data:', this.appsScriptUrl);
                    const response = await fetch(this.appsScriptUrl);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    this.rawData = data;
                    
                    // Cache the fresh data
                    this.setCachedData(data);
                    
                    this.displayData(data);
                    
                } catch (error) {
                    console.error('Error loading sheets data:', error);
                    
                    // Try to fall back to cached data if available
                    const cachedData = this.getCachedData();
                    if (cachedData) {
                        console.log('Falling back to cached data due to error');
                        this.rawData = cachedData.data;
                        this.displayData(cachedData.data);
                        this.showCacheWarning();
                    } else {
                        this.showError(error.message);
                    }
                }
            }
            
            showLoading() {
                if (this.refreshBtn) {
                    this.refreshBtn.disabled = true;
                    this.refreshBtn.textContent = 'Loading...';
                }
                
                this.contentDiv.innerHTML = '<div class="sheets-loading">Loading data...</div>';
            }
            
            showError(message) {
                this.contentDiv.innerHTML = `
                    <div class="sheets-error">
                        <strong>Error loading data:</strong> ${message}
                    </div>
                `;
                
                if (this.refreshBtn) {
                    this.refreshBtn.disabled = false;
                    this.refreshBtn.textContent = 'Refresh Data';
                }
            }
            
            displayData(rows) {
                if (!rows || rows.length === 0) {
                    this.showError('No data found');
                    return;
                }
                
                // Apply row limit if specified
                let displayRows = rows;
                let totalDataRows = rows.length - 1; // Exclude header
                
                if (this.options.maxRows && !this.options.pagination) {
                    // Simple row limiting with scrolling
                    displayRows = [rows[0], ...rows.slice(1, this.options.maxRows + 1)];
                }
                
                let html = '';
                
                // Add pagination controls if enabled
                if (this.options.pagination && rows.length > 1) {
                    const totalPages = Math.ceil(totalDataRows / this.options.rowsPerPage);
                    const startRow = (this.currentPage - 1) * this.options.rowsPerPage + 1;
                    const endRow = Math.min(startRow + this.options.rowsPerPage - 1, totalDataRows);
                    
                    displayRows = [
                        rows[0], // Header
                        ...rows.slice(startRow, endRow + 1)
                    ];
                    
                    html += this.createPaginationControls(totalPages, totalDataRows);
                }
                
                // Determine if we need scrolling
                const needsScrolling = !this.options.pagination && 
                                     (!this.options.maxRows || totalDataRows > this.options.maxRows);
                
                // Create table wrapper with appropriate styling
                const wrapperClass = needsScrolling ? 'sheets-table-wrapper' : 'sheets-table-wrapper no-scroll';
                const wrapperStyle = needsScrolling ? `max-height: ${this.options.maxHeight};` : '';
                
                html += `<div class="${wrapperClass}" style="${wrapperStyle}">`;
                html += '<table class="sheets-table">';
                
                // Header row with sorting
                if (displayRows.length > 0) {
                    html += '<tr>';
                    displayRows[0].forEach((cell, index) => {
                        // Skip hidden columns
                        if (this.options.hideColumns.includes(index)) return;
                        
                        const sortClass = this.sortColumn === index ? `sort-${this.sortDirection}` : '';
                        const sortable = this.options.sortable ? 'onclick="this.closest(\'.sheets-container\').sheetsEmbed.sortBy(' + index + ')"' : '';
                        html += `<th class="${sortClass}" ${sortable}>
                            ${String(cell || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}
                            ${this.options.sortable ? '<span class="sort-indicator"></span>' : ''}
                        </th>`;
                    });
                    html += '</tr>';
                    
                    // Data rows
                    for (let i = 1; i < displayRows.length; i++) {
                        html += '<tr>';
                        displayRows[i].forEach((cell, cellIndex) => {
                            // Skip hidden columns
                            if (this.options.hideColumns.includes(cellIndex)) return;
                            
                            const escapedCell = String(cell || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                            
                            // Check if this column should be converted to links
                            if (this.options.linkColumn === cellIndex && cell) {
                                const slug = this.createSlug(cell);
                                const url = this.options.linkPattern.replace('{slug}', slug);
                                html += `<td><a href="${url}" style="color: #4ecdc4; text-decoration: none;">${escapedCell}</a></td>`;
                            } else {
                                html += `<td>${escapedCell}</td>`;
                            }
                        });
                        html += '</tr>';
                    }
                }
                
                html += '</table>';
                html += '</div>'; // Close table wrapper
                
                if (this.options.showStats) {
                    const displayedRows = displayRows.length - 1;
                    const cachedData = this.getCachedData();
                    const isFromCache = cachedData && !this.isCacheExpired(cachedData.timestamp);
                    
                    // Count visible columns (excluding hidden ones)
                    const visibleColumns = rows[0]?.length ? rows[0].length - this.options.hideColumns.length : 0;
                    
                    let statsText = `‚öîÔ∏è Showing ${displayedRows} of ${totalDataRows} forces, ${visibleColumns} columns | Last updated: ${new Date().toLocaleString()}`;
                    
                    if (isFromCache) {
                        const cacheAgeHours = Math.round((Date.now() - cachedData.timestamp) / 3600000);
                        const cacheAgeMinutes = Math.round((Date.now() - cachedData.timestamp) / 60000);
                        
                        if (cacheAgeHours >= 1) {
                            statsText += ` | üíæ Cached ${cacheAgeHours}h ago`;
                        } else {
                            statsText += ` | üíæ Cached ${cacheAgeMinutes}m ago`;
                        }
                    }
                    
                    if (this.sortColumn !== null) {
                        statsText += ` | Sorted by column ${this.sortColumn + 1} (${this.sortDirection})`;
                    }
                    
                    if (this.options.pagination) {
                        statsText += ` | Page ${this.currentPage}`;
                    }
                    
                    html += `<div class="sheets-stats">${statsText}</div>`;
                }
                
                this.contentDiv.innerHTML = html;
                
                // Store reference to this embed instance for sorting
                this.container.sheetsEmbed = this;
                
                if (this.refreshBtn) {
                    this.refreshBtn.disabled = false;
                    this.refreshBtn.textContent = 'Refresh Data';
                }
            }
            
            createPaginationControls(totalPages, totalRows) {
                const startRow = (this.currentPage - 1) * this.options.rowsPerPage + 1;
                const endRow = Math.min(startRow + this.options.rowsPerPage - 1, totalRows);
                
                return `
                    <div class="sheets-pagination">
                        <button onclick="this.closest('.sheets-container').sheetsEmbed.goToPage(1)" 
                                ${this.currentPage === 1 ? 'disabled' : ''}>First</button>
                        <button onclick="this.closest('.sheets-container').sheetsEmbed.goToPage(${this.currentPage - 1})" 
                                ${this.currentPage === 1 ? 'disabled' : ''}>Previous</button>
                        
                        <span class="page-info">
                            Page ${this.currentPage} of ${totalPages} 
                            (forces ${startRow}-${endRow} of ${totalRows})
                        </span>
                        
                        <button onclick="this.closest('.sheets-container').sheetsEmbed.goToPage(${this.currentPage + 1})" 
                                ${this.currentPage === totalPages ? 'disabled' : ''}>Next</button>
                        <button onclick="this.closest('.sheets-container').sheetsEmbed.goToPage(${totalPages})" 
                                ${this.currentPage === totalPages ? 'disabled' : ''}>Last</button>
                        
                        <select onchange="this.closest('.sheets-container').sheetsEmbed.changeRowsPerPage(parseInt(this.value))">
                            <option value="25" ${this.options.rowsPerPage === 25 ? 'selected' : ''}>25 per page</option>
                            <option value="50" ${this.options.rowsPerPage === 50 ? 'selected' : ''}>50 per page</option>
                            <option value="100" ${this.options.rowsPerPage === 100 ? 'selected' : ''}>100 per page</option>
                            <option value="200" ${this.options.rowsPerPage === 200 ? 'selected' : ''}>200 per page</option>
                        </select>
                    </div>
                `;
            }
            
            goToPage(pageNumber) {
                if (!this.rawData) return;
                
                const totalDataRows = this.rawData.length - 1;
                const totalPages = Math.ceil(totalDataRows / this.options.rowsPerPage);
                
                this.currentPage = Math.max(1, Math.min(pageNumber, totalPages));
                this.displayData(this.rawData);
            }
            
            changeRowsPerPage(newRowsPerPage) {
                this.options.rowsPerPage = newRowsPerPage;
                this.currentPage = 1; // Reset to first page
                this.displayData(this.rawData);
            }
            
            sortBy(columnIndex) {
                if (!this.rawData || this.rawData.length <= 1) return;
                
                // Toggle sort direction if clicking the same column
                if (this.sortColumn === columnIndex) {
                    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortColumn = columnIndex;
                    this.sortDirection = 'asc';
                }
                
                // Create a copy of the data to sort
                const headerRow = this.rawData[0];
                const dataRows = this.rawData.slice(1);
                
                // Sort the data rows
                dataRows.sort((a, b) => {
                    let aVal = a[columnIndex] || '';
                    let bVal = b[columnIndex] || '';
                    
                    // Try to convert to numbers if possible
                    const aNum = parseFloat(aVal);
                    const bNum = parseFloat(bVal);
                    
                    if (!isNaN(aNum) && !isNaN(bNum)) {
                        // Numeric sort
                        return this.sortDirection === 'asc' ? aNum - bNum : bNum - aNum;
                    } else {
                        // String sort
                        aVal = String(aVal).toLowerCase();
                        bVal = String(bVal).toLowerCase();
                        
                        if (this.sortDirection === 'asc') {
                            return aVal.localeCompare(bVal);
                        } else {
                            return bVal.localeCompare(aVal);
                        }
                    }
                });
                
                // Rebuild the sorted data array
                const sortedData = [headerRow, ...dataRows];
                this.displayData(sortedData);
            }
            
            // Method to refresh data programmatically (bypasses cache)
            refresh() {
                this.clearCache(); // Clear cache before loading fresh data
                this.loadData();
            }
            
            // Create URL-friendly slug from text
            createSlug(text) {
                return String(text)
                    .toLowerCase()                    // Convert to lowercase
                    .trim()                          // Remove leading/trailing spaces
                    .replace(/[^\w\s-]/g, '')       // Remove special characters except spaces and hyphens
                    .replace(/[\s_-]+/g, '-')       // Replace spaces, underscores, multiple hyphens with single hyphen
                    .replace(/^-+|-+$/g, '');       // Remove leading/trailing hyphens
            }
            
            // Cache management methods
            getCacheKey() {
                // Create a unique cache key based on the Apps Script URL
                return `sheets_cache_${btoa(this.appsScriptUrl).replace(/[^a-zA-Z0-9]/g, '').substring(0, 20)}`;
            }
            
            getCachedData() {
                if (this.options.cacheMinutes <= 0) return null;
                
                try {
                    const cacheKey = this.getCacheKey();
                    const cached = localStorage.getItem(cacheKey);
                    return cached ? JSON.parse(cached) : null;
                } catch (error) {
                    console.warn('Error reading cache:', error);
                    return null;
                }
            }
            
            setCachedData(data) {
                if (this.options.cacheMinutes <= 0) return;
                
                try {
                    const cacheKey = this.getCacheKey();
                    const cacheData = {
                        data: data,
                        timestamp: Date.now(),
                        url: this.appsScriptUrl
                    };
                    localStorage.setItem(cacheKey, JSON.stringify(cacheData));
                    console.log(`Cached data for ${this.options.cacheMinutes} minutes (${Math.round(this.options.cacheMinutes/60)} hours)`);
                } catch (error) {
                    console.warn('Error setting cache:', error);
                }
            }
            
            isCacheExpired(timestamp) {
                if (this.options.cacheMinutes <= 0) return true;
                
                const cacheAgeMs = Date.now() - timestamp;
                const cacheExpireMs = this.options.cacheMinutes * 60 * 1000;
                return cacheAgeMs > cacheExpireMs;
            }
            
            clearCache() {
                try {
                    const cacheKey = this.getCacheKey();
                    localStorage.removeItem(cacheKey);
                    console.log('Cache cleared');
                } catch (error) {
                    console.warn('Error clearing cache:', error);
                }
            }
            
            showCacheWarning() {
                // Add a subtle indicator that we're showing cached data due to an error
                const existingStats = this.contentDiv.querySelector('.sheets-stats');
                if (existingStats) {
                    existingStats.innerHTML += ' | ‚ö†Ô∏è <em>Showing cached data (connection issue)</em>';
                    existingStats.style.backgroundColor = '#4a3a1e';
                    existingStats.style.borderLeft = '3px solid #ffa500';
                }
            }
        }

        // Manager class for easy setup
        class SheetsManager {
            static embeds = {};
            
            static embed(containerId, appsScriptUrl, options = {}) {
                const embed = new GoogleSheetsEmbed(`#${containerId}`, appsScriptUrl, options);
                this.embeds[containerId] = embed;
                return embed;
            }
            
            static refresh(containerId) {
                if (this.embeds[containerId]) {
                    this.embeds[containerId].refresh();
                }
            }
            
            static refreshAll() {
                Object.values(this.embeds).forEach(embed => embed.refresh());
            }
            
            static clearCache(containerId) {
                if (this.embeds[containerId]) {
                    this.embeds[containerId].clearCache();
                }
            }
            
            static clearAllCaches() {
                Object.values(this.embeds).forEach(embed => embed.clearCache());
            }
        }

        // Initialize your sheets when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            
            // Crusade Forces with form integration and hidden timestamp column
            SheetsManager.embed('crusade-forces-sheet', 'https://script.google.com/macros/s/AKfycbw81ZEFEAzOrfvOxWBHHT17kGqLrk3g-VpXuDeUbK_8YehP1dNe8FEUMf6PuDzZ4JnH/exec', {
                maxHeight: '350px',     // Good height for mobile
                showStats: true,        // Show force statistics
                sortable: true,         // Allow sorting by any column
                linkColumn: 2,          // Force Name is now column 2 (after hidden Timestamp)
                linkPattern: 'forces/{slug}.html',  // URL pattern for force pages
                cacheMinutes: 1440,     // Cache data for 24 hours (1440 minutes)
                hideColumns: [0]        // Hide the first column (Timestamp)
            });
            
            // Future sheets for other sections:
            
            // Active Crusades with pagination for battle history
            // SheetsManager.embed('active-crusades-sheet', 'YOUR_ACTIVE_CRUSADES_URL', {
            //     pagination: true,
            //     rowsPerPage: 10,
            //     showRefreshButton: false
            // });
            
            // Battle Reports/Stories with limited rows
            // SheetsManager.embed('stories-sheet', 'YOUR_STORIES_URL', {
            //     maxRows: 20,
            //     maxHeight: '300px'
            // });
        });

        // Global functions for cache management
        function refreshAllBattleData() {
            SheetsManager.refreshAll();
        }
        
        function clearAllCaches() {
            SheetsManager.clearAllCaches();
            console.log('All caches cleared');
        }
        
        function clearSpecificCache(containerId) {
            SheetsManager.clearCache(containerId);
            console.log(`Cache cleared for ${containerId}`);
        }
    </script>
</body>
</html>